#!/usr/bin/env bash
# Script that configures a new Ubuntu machine with Nginx
# Nginx should be listening on port 80
# When querying Nginx at its root / with a GET request, it must return a page that contains "Holberton School"

# Update package list and install nginx
apt-get update -y
apt-get install nginx -y

# Create the HTML page with "Holberton School"
echo "Holberton School for the win!" > /var/www/html/index.html

# Backup the original default config
cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Configure nginx to listen on port 80 and serve our page
cat > /etc/nginx/sites-available/default <<'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    
    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;
    
    server_name _;
    
    location / {
        try_files $uri $uri/ =404;
    }
}
EOF

# Remove any existing symbolic link and create a new one
rm -f /etc/nginx/sites-enabled/default
ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Test nginx configuration
nginx -t

# Restart nginx using service command (not systemctl)
service nginx restart
