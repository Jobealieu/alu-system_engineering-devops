#!/usr/bin/env bash
# Configure Nginx to run as nginx user and listen on port 8080

# Stop all web servers
pkill -9 apache2
killall -9 nginx 2>/dev/null

# Configure nginx to run as nginx user
sed -i 's/^user.*/user nginx;/' /etc/nginx/nginx.conf

# Configure port 8080
sed -i 's/80/8080/g' /etc/nginx/sites-enabled/default

# Fix ownership and permissions
chown -R nginx:nginx /var/log/nginx
chown -R nginx:nginx /var/lib/nginx
chmod 755 /var/lib/nginx

# Start nginx as nginx user directly
sudo -u nginx /usr/sbin/nginx -g 'daemon off;' &
